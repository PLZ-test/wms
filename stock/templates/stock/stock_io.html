{% extends 'core/base.html' %}

{% block content %}
<div class="page-header">
    <div>
        <a href="{% url 'core:dashboard' %}" class="btn btn-secondary">뒤로가기</a>
    </div>
    <h1>재고 입출고</h1>
    <div class="btn-group">
        <a href="{% url 'stock:history' %}" class="btn btn-info">입출고 기록 보기</a>
    </div>
</div>

<p>현재 필터: <strong>{{ selected_center|default:'전체 센터' }}</strong>, <strong>{{ selected_shipper|default:'전체 화주사' }}</strong></p>

{% if messages %}
    {% for message in messages %}
        <p class="message {{ message.tags }}">{{ message }}</p>
    {% endfor %}
{% endif %}

{% if not products %}
    <p>등록된 상품이 없습니다. '관리' 메뉴에서 상품을 먼저 등록해주세요.</p>
{% else %}
<div class="io-container">
    <div class="io-box">
        <h2>입고</h2>
        <div class="form-container">
            <form id="stock-in-form" method="post" action="{% url 'stock:io' %}">
                {% csrf_token %}
                <input type="hidden" name="io_type" value="in">
                
                <div class="form-group">
                    <label for="id_product_in">상품 선택:</label>
                    <select id="id_product_in" name="product" required>
                        <option value="">선택하세요</option>
                        {% for p in products %}
                        <option value="{{ p.id }}">[ {{ p.shipper.name }} ] {{ p.name }} (현재 재고: {{ p.quantity }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_quantity_in">입고 수량:</label>
                    <input type="number" id="id_quantity_in" name="quantity" required min="1">
                </div>
                
                <div class="form-group">
                    <label for="id_memo_in">메모:</label>
                    <textarea name="memo" id="id_memo_in" rows="3"></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">입고 처리</button>
                </div>
            </form>
        </div>
    </div>
    <div class="io-box">
        <h2>출고</h2>
        <div class="form-container">
            <form id="stock-out-form" method="post" action="{% url 'stock:io' %}">
                {% csrf_token %}
                <input type="hidden" name="io_type" value="out">

                <div class="form-group">
                    <label for="id_product_out">상품 선택:</label>
                    <select id="id_product_out" name="product" required>
                        <option value="">선택하세요</option>
                        {% for p in products %}
                        <option value="{{ p.id }}">[ {{ p.shipper.name }} ] {{ p.name }} (현재 재고: {{ p.quantity }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_quantity_out">출고 수량:</label>
                    <input type="number" id="id_quantity_out" name="quantity" required min="1">
                </div>
                
                <div class="form-group">
                    <label for="id_memo_out">메모:</label>
                    <textarea name="memo" id="id_memo_out" rows="3"></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-danger">출고 처리</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}