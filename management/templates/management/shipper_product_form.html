{% extends 'core/base.html' %}

{% block content %}
<div class="page-header">
    <div>
        <a href="{% if form.instance.pk %}{% url 'management:product_list' form.instance.shipper.pk %}{% else %}{% url 'management:product_list' shipper.pk %}{% endif %}" class="btn btn-secondary">뒤로가기</a>
    </div>
    <h1>{{ page_title }}</h1>
    <div class="btn-group"></div>
</div>

<div class="form-container">
    <form id="product-form" method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="{{ form.name.id_for_label }}">상품명:</label>
            {{ form.name }}
        </div>

        <div class="form-group">
            <label for="{{ form.barcode.id_for_label }}">바코드:</label>
            {{ form.barcode }}
        </div>
        
        <div class="form-group">
            <label>크기 (cm):</label>
            <div class="size-input-group">
                {{ form.width }}
                <span>x</span>
                {{ form.length }}
                <span>x</span>
                {{ form.height }}
            </div>
        </div>

        {# --- [추가] 새로운 필드 입력 칸 --- #}
        <div class="form-group">
            <label for="{{ form.quantity.id_for_label }}">재고 수량:</label>
            {{ form.quantity }}
        </div>
        <div class="form-group">
            <label for="{{ form.products_per_pallet.id_for_label }}">파렛트 당 상품 수:</label>
            {{ form.products_per_pallet }}
        </div>
        <div class="form-group">
            <label for="{{ form.pallet_quantity.id_for_label }}">파렛트 수량:</label>
            {{ form.pallet_quantity }}
        </div>
        {# --------------------------------- #}

        {% if form.errors %}
            <div class="error-list" style="padding-left: 115px; color: var(--danger-color);">
                {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                {% endfor %}
            </div>
        {% endif %}
    </form>
    <div class="form-actions">
        
        {% if form.instance.pk %}
            {% if form.instance.quantity > 0 %}
                <button type="button" class="btn btn-danger" onclick="alert('재고가 남아 있습니다. 재고를 먼저 비워주세요.');">삭제</button>
            {% else %}
                <form action="{% url 'management:product_delete' form.instance.pk %}" method="post" style="display: inline;" onsubmit="return confirm('정말로 삭제하시겠습니까?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">삭제</button>
                </form>
            {% endif %}
        {% endif %}
        
        <button type="submit" class="btn btn-primary" form="product-form">
            {% if form.instance.pk %}수정{% else %}등록{% endif %}
        </button>
    </div>
</div>
{% endblock %}